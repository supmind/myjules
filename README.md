# MiniJules: 一个“类 Jules”架构的自主 AI 开发者

MiniJules 是一个高级实验项目，旨在构建一个**单一、迭代、基于工具的自主 AI 软件工程师**。它的核心架构受到了像 Jules 这样的高级 AI 助手的启发，摒弃了传统的多代理、预规划模式，采用了一个更灵活、更强大的“观察-思考-行动”循环。

## 核心架构：Jules 哲学

本项目的灵魂在于其操作哲学：**智能体不应该预先规划所有步骤，而应在每一步之后观察结果，并动态决定下一步的最佳行动。**

1.  **`CoreAgent` (核心代理)**:
    *   **角色**: 项目的唯一“大脑”。
    *   **职责**: 接收一个包含任务目标和完整行动历史的提示，然后决定出**下一步要执行的唯一一个工具调用**。它的系统提示经过精心设计，引导它进行上下文感知、遵循 TDD 原则，并能在需要时委派复杂的工作流。

2.  **`JulesApp` (应用编排器)**:
    *   **角色**: 整个流程的主控循环。
    *   **职责**:
        *   初始化任务状态。
        *   在一个循环中，反复向 `CoreAgent` 请求下一步行动。
        *   调用 `tools` 模块来执行该行动。
        *   将行动的结果更新到工作历史中。
        *   将更新后的历史再次提供给 `CoreAgent`，直到任务完成。

3.  **`TaskState` (结构化状态管理器)**:
    *   **角色**: 一个专门的 `dataclass`。
    *   **职责**: 封装所有与当前任务相关的状态（任务描述、工作历史、项目语言等）到一个干净、可传递的对象中，极大地提高了代码的可读性和健壮性。

4.  **`tools.py` (工具箱)**:
    *   **角色**: `CoreAgent` 的“双手”。
    *   **职责**: 提供一系列原子化和复合化的工具，包括：
        *   **文件操作**: 安全地读、写、创建、删除文件。
        *   **代码解析与修改**: 基于 `tree-sitter` 的 AST（抽象语法树）精确修改代码。
        *   **环境与依赖管理**: 运行 shell 命令并管理项目依赖。
        *   **版本控制**: 与 Git 仓库进行交互。

## 关键特性

-   **代理驱动的 RAG**: `CoreAgent` 可以通过 `retrieve_code_context` 工具，**在它认为需要时主动地**查询代码库，而不是被动地接收上下文。这使得信息获取更高效、更智能。
-   **长期记忆**: 系统现在拥有一个记忆库 (`ChromaDB`)。
    *   **学习**: 每当一个任务成功完成，其完整的执行历史和代码变更摘要都会被存入记忆库。
    *   **应用**: 当接到一个新任务时，系统会首先检索过去相似的成功案例，并将这些经验提供给 `CoreAgent` 作为参考。
-   **复合工具 (`execute_tdd_cycle`)**: 这是一个高级工具，它将整个 TDD 流程（写失败的测试 -> 写实现 -> 验证通过）封装成一个单一的、可调用的动作。这允许 `CoreAgent` 从繁琐的步骤中解放出来，专注于更高层次的战略规划。
-   **自动语言检测**: 应用启动时会自动扫描工作区，以确定项目的主要编程语言，从而简化了测试等工具的调用。
-   **可扩展的语言配置**: 所有特定于语言的配置（如测试命令、AST 节点类型）都已外部化到 `minijules/language_config.json` 文件中，使得添加对新语言的支持变得异常简单。

## 安装

1.  克隆此仓库。
2.  确保您已安装 Python 3.9+。
3.  建议创建一个虚拟环境。
4.  安装所有必需的依赖项：
    ```bash
    python3 -m pip install -r requirements.txt
    ```

## 如何运行

通过命令行启动 MiniJules，并向其分配一个任务。

**基本用法:**
```bash
python3 -m minijules.app "您的任务描述"
```
**示例:**
```bash
python3 -m minijules.app "在 a.py 中创建一个名为 'add' 的函数，它接受两个参数并返回它们的和，并为它编写一个测试。"
```

**自主模式:**
添加 `--auto` 标志，程序将无需为每一步操作手动按 Enter 键确认，实现完全自主运行。
```bash
python3 -m minijules.app "您的任务描述" --auto
```

## 配置

-   **语言模型 (LLM)**:
    *   在项目根目录下创建一个 `.env` 文件。
    *   参考 `.env.template`，在其中设置您的 `OAI_CONFIG_LIST` 环境变量。
-   **语言工具**:
    *   如需扩展对新语言的支持，请直接修改 `minijules/language_config.json` 文件，添加新的语言配置。